<template>
  <section v-if="generate">
    <div class="font2">
      <span class="font2-txt">æ—¶è‡³ä»Šæ—¥ï¼Œ</span>
      <span class="font2-txt">æˆ‘ä»¬çš„æ—…ç¨‹å·²ç»å¼€å§‹äº† x å¤©ã€‚</span>
      <span class="font2-txt">çœ‹ä¼¼ä¸€çœ¨çœ¼çš„æ—¶é—´ï¼Œ</span>
      <span class="font2-txt">å´æ‰¿è½½äº†æˆ‘ä»¬æ— å¯å¿˜å´çš„çé‡å›å¿†ã€‚</span>
      <span class="font2-txt">ä»¥è¿™ä»½å›å¿†çš„é‡é‡æ‰€ç¼–ç»‡çš„çº½å¸¦ï¼Œ</span>
      <span class="font2-txt">æ­£æ˜¯è¿ç»“æˆ‘ä»¬å¹¶ä¸€èµ·å‰è¿›çš„åŠ¨åŠ›ã€‚</span>
      <span class="font2-txt">æ„¿æ—¶é—´ä¸ä½ å…±å†™ç¾æ¢¦ï¼Œæ„¿ç¥ç¦ä¼´ä½ ç»ˆæŠµäº‘é¡¶ã€‚</span>
      <span class="font2-txt">æ„Ÿè°¢é™ªä¼´ï¼</span>
    </div>
    <button class="btn" @click="gosum">ç‚¹å‡»ç”Ÿæˆä½ çš„ä¸“å±OJå¹´æŠ¥ğŸ¥³</button>
    <div class="sdutoj">
      <div class="font1">
        Practice coding, compete with players, and become a master.
      </div>
      <div class="bottom-icon">
        <img src="../assets/img/bottomicon.png" alt="" class="btm-txt" />
        <img
          src="../assets/img/bLue.png"
          alt=""
          height="60%"
          style="position: relative; right: 0.2rem"
        />
        <p class="blue">bLue</p>
        <img
          src="../assets/img/and.png"
          alt=""
          height="50%"
          style="position: relative; right: 0.1rem"
        />
        <img src="../assets/img/qq.png" alt="" height="60%" />
        <p class="atrior">atrior</p>
        <div class="wline"></div>
        <img
          src="../assets/img/LCL_hero_dark.bfdc1ef6.png"
          alt=""
          height="100%"
          class="lcllab"
        />
      </div>
      <span ref="text1" class="chars">S</span>
      <span ref="text2" class="chars">D</span>
      <span ref="text3" class="chars">U</span>
      <span ref="text4" class="nc">T</span>
      <span ref="text5" class="nc">O</span>
      <span ref="text6" class="nc">J</span>
    </div>
  </section>
  <section v-else class="summ">
    <button class="main-button" @click="downloadAsImage">
      <svg
        width="30"
        height="30"
        fill="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M15.75 5.125a3.125 3.125 0 1 1 .754 2.035l-8.397 3.9a3.124 3.124 0 0 1 0 1.88l8.397 3.9a3.125 3.125 0 1 1-.61 1.095l-8.397-3.9a3.125 3.125 0 1 1 0-4.07l8.397-3.9a3.125 3.125 0 0 1-.144-.94Z"
        ></path>
      </svg>
    </button>
    <div class="sumarry" ref="sumarry">
      <img
        src="../assets/img/sdutacm_logo_colorful-02a05aa9.svg"
        alt=""
        class="back"
      />
      <div class="topoj">SDUT Online Judge</div>
      <div class="results-summary-container">
        <div class="confetti">
          <div class="confetti-piece"></div>
          <div class="confetti-piece"></div>
          <div class="confetti-piece"></div>
          <div class="confetti-piece"></div>
          <div class="confetti-piece"></div>
          <div class="confetti-piece"></div>
          <div class="confetti-piece"></div>
          <div class="confetti-piece"></div>
          <div class="confetti-piece"></div>
          <div class="confetti-piece"></div>
          <div class="confetti-piece"></div>
          <div class="confetti-piece"></div>
          <div class="confetti-piece"></div>
          <div class="confetti-piece"></div>
          <div class="confetti-piece"></div>
          <div class="confetti-piece"></div>
          <div class="confetti-piece"></div>
          <div class="confetti-piece"></div>
          <div class="confetti-piece"></div>
        </div>
        <div class="results-summary-container__result">
          <div class="heading-tertiary">ä½ çš„OJå¹´æŠ¥<span>ğŸ¥³</span></div>
          <div class="result-box">
            <img src="../assets/img/qq.png" alt="" />
          </div>
          <div class="result-text-box">
            <div class="heading-secondary">ATRIOR</div>
            <div class="paragraph">
              <div class="ac-num">
                <p>æ€»AC:<span>1111</span></p>
                <p>ä»Šå¹´AC:<span>234</span></p>
                <p>90%</p>
              </div>
              <div class="rating">
                Rating:<span class="rating-color">1900</span>
              </div>
              <div class="achiv-num">æ€»æˆå°±æ•°:<span>89</span></div>
              <div class="contests">
                <li
                  v-for="(item, index) in contests"
                  :key="index"
                  class="bisai"
                >
                  <span>{{ item.name }}</span>
                  <span>{{ item.rank }}</span>
                </li>
              </div>
            </div>
          </div>
        </div>
        <div class="results-summary-container__options">
          <div class="tag-head">2024å›å¿†æ ‡ç­¾âœ¨ï¸</div>
          <!-- <div class="heading-secondary heading-secondary--blue">Summary</div> -->
          <ul class="summary-result-options">
            <li v-for="(item, index) in tags" :key="index" class="tag">
              {{ item }}
            </li>
          </ul>
        </div>
      </div>
    </div>
  </section>
</template>

<script setup>
import { ref, onMounted, nextTick } from "vue";
const text1 = ref(null);
const text2 = ref(null);
const text3 = ref(null);
const text4 = ref(null);
const text5 = ref(null);
const text6 = ref(null);
const ojoj = ref(null);
const generate = ref(true);

function gosum() {
  setTimeout(() => {
    generate.value = false;
  }, 600);
}
onMounted(() => {
  setTimeout(() => {
    nextTick(() => {
      let shadow = "";
      let shadow3 = "";
      let total = 10;
      for (let i = 1; i <= total; i++) {
        shadow += `-${i}px ${i}px #c2c2c2,`;
      }
      for (let i = 1; i <= total; i++) {
        shadow3 += `${i}px ${i}px #c2c2c2,`;
      }
      shadow = shadow.slice(0, -1);
      shadow3 = shadow3.slice(0, -1);

      if (text1.value) text1.value.style.textShadow = shadow;
      if (text2.value) text2.value.style.textShadow = shadow;
      if (text3.value) text3.value.style.textShadow = shadow;
      if (text4.value) text4.value.style.textShadow = shadow3;
      if (text5.value) text5.value.style.textShadow = shadow3;
      if (text6.value) text6.value.style.textShadow = shadow3;

      const charsanimation = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              setTimeout(() => {
                entry.target.classList.add("charsanim");
                const title = document.querySelector(".title");
                title.classList.remove("fontactive");
              }, 14000);
            } else {
              entry.target.classList.remove("charsanim");
            }
          });
        },
        { threshold: 0.1 }
      );

      const fontanimation = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              setTimeout(() => {
                entry.target.classList.add("font1anim");
              }, 14000);
            } else {
              entry.target.classList.remove("font1anim");
            }
          });
        },
        { threshold: 0.1 }
      );

      const font2animation = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              const font2txt = document.querySelectorAll(".font2-txt");
              font2txt.forEach((ft) => {
                ft.classList.add("font2anim");
              });
              setTimeout(() => {
                entry.target.classList.add("remove");
              }, 13000);
              setTimeout(() => {
                const sdutoj = document.querySelector(".sdutoj");
                sdutoj.classList.add("sdutojanim");
                const btn = document.querySelector(".btn");
                btn.classList.add("sdutojanim");
              }, 14000);
            }
          });
        },
        { threshold: 0.1 }
      );

      const bottomIconanim = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              setTimeout(() => {
                entry.target.classList.add("btm-logo");
              }, 14000);
            } else {
              entry.target.classList.remove("btm-logo");
            }
          });
        },
        { threshold: 0.1 }
      );
      const chars = document.querySelectorAll(".chars, .nc");
      chars.forEach((char) => {
        charsanimation.observe(char);
      });
      const fonts = document.querySelector(".font1");
      fontanimation.observe(fonts);
      const font2s = document.querySelector(".font2");
      font2animation.observe(font2s);

      const bottomIcon = document.querySelector(".bottom-icon");
      bottomIconanim.observe(bottomIcon);
    });
  }, 100);
});

const sumarry = ref(null);
const tags = ref([
  "åˆ·é¢˜ç‹",
  "å¤œçŒ«å­",
  "ç™¾æŠ˜ä¸æŒ ",
  "åŸç¥å¯åŠ¨!",
  "æ ¡èµ›æ˜æ˜Ÿ",
  "æ–°æ˜Ÿ",
  "é˜Ÿä¼çš„ç¾ç»Š",
]);
const contests = ref([
  {
    name: "æ“‚å°èµ›",
    rank: 12,
  },
  {
    name: "æ–°ç”Ÿèµ›",
    rank: 12,
  },
  {
    name: "æ ¡èµ›",
    rank: 12,
  },
  {
    name: "åŸç¥èµ›",
    rank: 12,
  },
]);

function downloadAsImage() {
  nextTick(() => {
    if (sumarry.value) {
      html2canvas(sumarry.value, {
        useCORS: true, // å¯ç”¨è·¨åŸŸæ”¯æŒ
        scale: 2, // æå‡å›¾ç‰‡åˆ†è¾¨ç‡
      }).then((canvas) => {
        // å°† canvas è½¬æ¢ä¸ºå›¾ç‰‡ URL
        const imgUrl = canvas.toDataURL("image/png");
        // åˆ›å»ºä¸€ä¸ªä¸‹è½½é“¾æ¥
        const link = document.createElement("a");
        link.href = imgUrl;
        link.download = "webpage_image.png"; // è®¾ç½®ä¸‹è½½æ–‡ä»¶å
        link.click(); // æ¨¡æ‹Ÿç‚¹å‡»ä¸‹è½½
      });
    } else {
      console.log("null");
    }
  });
  // ä½¿ç”¨ html2canvas æˆªå– #content å…ƒç´ çš„å†…å®¹
}
</script>
<style scoped>
@import url("../assets/sumarry.css");
@import url("../assets/last.css");
section {
  position: absolute;
  top: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  height: 100vh;
  overflow: hidden;
  transition: all 0.3s linear;
}
.remove {
  opacity: 0;
}
.btm-logo {
  animation: opop ease 1s forwards;
  animation-delay: 7.5s;
}

.animrunning {
  animation-play-state: running;
}

@keyframes opop {
  100% {
    opacity: 1;
  }
}
.sdutojanim {
  opacity: 1;
  filter: blur(0);
  animation: upmove 1.5s ease forwards;
  animation-delay: 7.5s;
}

@keyframes upmove {
  from {
    transform: translateY(0);
  }
  to {
    transform: translateY(-1rem);
  }
}

.summ {
  opacity: 1 !important;
  transition: all 0.5s ease-in-out;
  transform: translateY(0) !important;
}
</style>
